"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var VOLUME_ICONS={up:"fa-volume-up",down:"fa-volume-down",off:"fa-volume-off",mute:"fa-volume-mute"},FULLSCREEN_ICONS={compress:"fa-compress",expand:"fa-expand"},Player=/*#__PURE__*/function(){function a(b){var c;if(_classCallCheck(this,a),this.player=document.querySelector(b),this.video=null===(c=this.player)||void 0===c?void 0:c.querySelector("video"),!this.player||!this.video)throw new Error("Player or video not found");this.initVideoListeners(),this.initPlayerListeners(),this.initTimelineListeners(),this.initPageListeners()}return _createClass(a,[{key:"initVideoListeners",value:function initVideoListeners(){var a=this;this.video.addEventListener("click",this.toggleVideo.bind(this)),this.video.addEventListener("loadedmetadata",function(){a.setVideoDuration(),a.updateVolumeInput()}),this.video.addEventListener("timeupdate",function(){a.setVideoDuration(),a.toggleInterface()}),this.video.addEventListener("dblclick",this.toggleFullscreen.bind(this)),this.video.addEventListener("volumechange",this.updateVolumeInput.bind(this))}},{key:"initPlayerListeners",value:function initPlayerListeners(){var a=this;this.player.addEventListener("fullscreenchange",this.checkFullscreen.bind(this)),this.player.addEventListener("mousemove",this.checkInterface.bind(this)),this.player.querySelector(".j-toggle-video").addEventListener("click",this.toggleVideo.bind(this)),this.player.querySelector(".j-volume-input").addEventListener("input",this.setVolume.bind(this)),this.player.querySelector(".j-toggle-volume").addEventListener("click",function(){a.video.volume=+(1!==a.video.volume)}),this.player.querySelector(".j-fullscreen").addEventListener("click",this.toggleFullscreen.bind(this)),this.player.querySelector(".speed__change-button--speed-down").addEventListener("click",this.changeSpeedDown.bind(this)),this.player.querySelector(".speed__change-button--speed-up").addEventListener("click",this.changeSpeedUp.bind(this))}},{key:"initTimelineListeners",value:function initTimelineListeners(){var a=this,b=this.player.querySelector(".j-line");b.addEventListener("mousemove",this.calcGhostLine.bind(this)),b.addEventListener("click",function(b){var c=b.target.getBoundingClientRect(),d=c.left;a.video.currentTime=a.calcNeededLine(b,d)})}},{key:"initPageListeners",value:function initPageListeners(){var a=this;document.addEventListener("keydown",function(b){"Space"===b.code?(b.preventDefault(),a.toggleVideo()):"ArrowRight"===b.code?a.video.currentTime+=5:"ArrowLeft"===b.code&&(a.video.currentTime-=5)})}},{key:"setVolume",value:function setVolume(a){var b=a.target;this.video.volume=b.value/100}},{key:"toggleVideo",value:function toggleVideo(){this.isPlaying=!this.isPlaying;var a=this.player.querySelector(".j-toggle-video .fas");this.player.querySelector(".j-play").style.display=this.isPlaying?"block":"none",this.player.querySelector(".j-pause").style.display=this.isPlaying?"none":"block",a.classList.toggle("fa-play",!this.isPlaying),a.classList.toggle("fa-pause",this.isPlaying),this.video[this.isPlaying?"play":"pause"]()}},{key:"fixNumber",value:function fixNumber(a){return 10>a?"0".concat(a):"".concat(a)}},{key:"formatTime",value:function formatTime(a){var b=Math.floor;return"".concat(b(a/60),":").concat(this.fixNumber(b(a%60)))}},{key:"setVideoDuration",value:function setVideoDuration(){var a=+this.video.duration.toFixed(),b=+this.video.currentTime.toFixed(),c="".concat(this.formatTime(b)," / ").concat(this.formatTime(a)),d=this.player.querySelector(".j-duration");this.player.querySelector(".j-line-current").style.width="".concat(b/(a/100),"%"),d.innerHTML!==c&&(d.innerHTML=c)}},{key:"toggleFullscreen",value:function toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.player.requestFullscreen(),this.player.requestFullscreen()}},{key:"checkFullscreen",value:function checkFullscreen(){var a=!!document.fullscreenElement,b=this.player.querySelector(".j-fullscreen .fas");b.classList.toggle(FULLSCREEN_ICONS.compress,!a),b.classList.toggle(FULLSCREEN_ICONS.expand,a),this.player.classList.toggle("player--fullscreen",a)}},{key:"calcNeededLine",value:function calcNeededLine(a,b){var c=(a.clientX-b)/a.target.offsetWidth;return this.video.duration*c}},{key:"updateVolumeInput",value:function updateVolumeInput(){var a=this.player.querySelector(".j-toggle-volume").classList;this.player.querySelector(".j-volume-input").value=100*this.video.volume,a.remove(VOLUME_ICONS.up,VOLUME_ICONS.down,VOLUME_ICONS.off,VOLUME_ICONS.mute),.66<this.video.volume?a.add(VOLUME_ICONS.up):.33<this.video.volume?a.add(VOLUME_ICONS.down):0<this.video.volume?a.add(VOLUME_ICONS.off):0===this.video.volume&&a.add(VOLUME_ICONS.mute)}},{key:"calcGhostLine",value:function calcGhostLine(a){var b=a.target.getBoundingClientRect(),c=b.left,d=this.player.querySelector(".j-hint"),e=this.player.querySelector(".j-line-ghost");d.innerHTML=this.formatTime(this.calcNeededLine(a,c)),d.style.left="".concat(a.clientX-(c+d.offsetWidth/2),"px"),e.style.width="".concat(a.clientX-c,"px")}},{key:"toggleInterface",value:function toggleInterface(){this.player.classList.toggle("player--hide-interface",this.isHiddenInterface)}},{key:"checkInterface",value:function checkInterface(){var a=this;this.isHiddenInterface=!1,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){a.isHiddenInterface=!0},5e3)}},{key:"changeSpeedDown",value:function changeSpeedDown(){var a=document.querySelector(".speed__change-button--speed-down");(window.target=a)&&(this.video.playbackRate-=.25),.25>=this.video.playbackRate&&(this.video.playbackRate=.25),console.log(this.video.playbackRate)}},{key:"changeSpeedUp",value:function changeSpeedUp(){var a=document.querySelector(".speed__change-button--speed-up");(window.target=a)&&(this.video.playbackRate+=.25),console.log(this.video.playbackRate)}}]),a}(),player=new Player(".j-player"),sidebarBurger=document.querySelector(".header__nav_burger"),headerNav=document.querySelector(".header__nav-list");window.addEventListener("click",function(a){(a.target==sidebarBurger||a.target!==headerNav&&sidebarBurger!==a.target&&headerNav.classList.contains("header__nav-list--active"))&&headerNav.classList.toggle("header__nav-list--active")});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvcGxheWVyLmpzIl0sIm5hbWVzIjpbIlZPTFVNRV9JQ09OUyIsInVwIiwiZG93biIsIm9mZiIsIm11dGUiLCJGVUxMU0NSRUVOX0lDT05TIiwiY29tcHJlc3MiLCJleHBhbmQiLCJQbGF5ZXIiLCJzZWxlY3RvciIsInBsYXllciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInZpZGVvIiwiRXJyb3IiLCJpbml0VmlkZW9MaXN0ZW5lcnMiLCJpbml0UGxheWVyTGlzdGVuZXJzIiwiaW5pdFRpbWVsaW5lTGlzdGVuZXJzIiwiaW5pdFBhZ2VMaXN0ZW5lcnMiLCJhZGRFdmVudExpc3RlbmVyIiwidG9nZ2xlVmlkZW8iLCJiaW5kIiwic2V0VmlkZW9EdXJhdGlvbiIsInVwZGF0ZVZvbHVtZUlucHV0IiwidG9nZ2xlSW50ZXJmYWNlIiwidG9nZ2xlRnVsbHNjcmVlbiIsImNoZWNrRnVsbHNjcmVlbiIsImNoZWNrSW50ZXJmYWNlIiwic2V0Vm9sdW1lIiwidm9sdW1lIiwiY2hhbmdlU3BlZWREb3duIiwiY2hhbmdlU3BlZWRVcCIsImxpbmUiLCJjYWxjR2hvc3RMaW5lIiwiZXZlbnQiLCJ0YXJnZXQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0IiwiY3VycmVudFRpbWUiLCJjYWxjTmVlZGVkTGluZSIsImNvZGUiLCJwcmV2ZW50RGVmYXVsdCIsInZhbHVlIiwiaXNQbGF5aW5nIiwiaWNvbiIsInN0eWxlIiwiZGlzcGxheSIsImNsYXNzTGlzdCIsInRvZ2dsZSIsIm51bWJlciIsInNlY29uZHMiLCJNYXRoIiwiZmxvb3IiLCJmaXhOdW1iZXIiLCJkdXJhdGlvbiIsInRvRml4ZWQiLCJjdXJyZW50IiwibmV3VGltZSIsImZvcm1hdFRpbWUiLCJkdXJhdGlvbkVsZW1lbnQiLCJ3aWR0aCIsImlubmVySFRNTCIsImZ1bGxzY3JlZW5FbGVtZW50IiwiZXhpdEZ1bGxzY3JlZW4iLCJyZXF1ZXN0RnVsbHNjcmVlbiIsImlzRnVsbHNjcmVlbiIsIm5lZWRQZXJjZW50IiwiY2xpZW50WCIsIm9mZnNldFdpZHRoIiwidG9nZ2xlQ2xhc3NlcyIsInJlbW92ZSIsImFkZCIsImhpbnQiLCJnaG9zdCIsImlzSGlkZGVuSW50ZXJmYWNlIiwidGltZW91dCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJzcGVlZERvd24iLCJ3aW5kb3ciLCJwbGF5YmFja1JhdGUiLCJjb25zb2xlIiwibG9nIiwic3BlZWRVcCIsInNpZGViYXJCdXJnZXIiLCJoZWFkZXJOYXYiLCJlIiwiY29udGFpbnMiXSwibWFwcGluZ3MiOiJrWkFBQUEsQ0FBQUEsWUFBQSxDQUFBLENBQ0FDLEVBQUEsQ0FBQSxjQURBLENBRUFDLElBQUEsQ0FBQSxnQkFGQSxDQUdBQyxHQUFBLENBQUEsZUFIQSxDQUlBQyxJQUFBLENBQUEsZ0JBSkEsQyxDQU1BQyxnQkFBQSxDQUFBLENBQ0FDLFFBQUEsQ0FBQSxhQURBLENBRUFDLE1BQUEsQ0FBQSxXQUZBLEMsQ0FJQUMsTSx5QkFDQSxXQUFBQyxDQUFBLENBQUEsT0FHQSwyQkFGQSxLQUFBQyxNQUFBLENBQUFDLFFBQUEsQ0FBQUMsYUFBQSxDQUFBSCxDQUFBLENBRUEsQ0FEQSxLQUFBSSxLQUFBLFdBQUEsS0FBQUgsTUFBQSxxQkFBQSxFQUFBRSxhQUFBLENBQUEsT0FBQSxDQUNBLENBQUEsQ0FBQSxLQUFBRixNQUFBLEVBQUEsQ0FBQSxLQUFBRyxLQUFBLENBQ0EsS0FBQSxJQUFBQyxDQUFBQSxLQUFBLENBQUEsMkJBQUEsQ0FBQSxDQUVBLEtBQUFDLGtCQUFBLEVBTkEsQ0FPQSxLQUFBQyxtQkFBQSxFQVBBLENBUUEsS0FBQUMscUJBQUEsRUFSQSxDQVNBLEtBQUFDLGlCQUFBLEVBQ0EsQyx1REFDQSw2QkFBQSxZQUNBLEtBQUFMLEtBQUEsQ0FBQU0sZ0JBQUEsQ0FBQSxPQUFBLENBQUEsS0FBQUMsV0FBQSxDQUFBQyxJQUFBLENBQUEsSUFBQSxDQUFBLENBREEsQ0FFQSxLQUFBUixLQUFBLENBQUFNLGdCQUFBLENBQUEsZ0JBQUEs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WUFMQSxHQU1BLEtBQUFuRSxLQUFBLENBQUFtRSxZQUFBLENBQUEsR0FOQSxFQVFBQyxPQUFBLENBQUFDLEdBQUEsQ0FBQSxLQUFBckUsS0FBQSxDQUFBbUUsWUFBQSxDQUNBLEMsNkJBQ0Esd0JBQUEsQ0FDQSxHQUFBRyxDQUFBQSxDQUFBLENBQUF4RSxRQUFBLENBQUFDLGFBQUEsQ0FBQSxpQ0FBQSxDQUFBLENBREEsQ0FFQW1FLE1BQUEsQ0FBQTVDLE1BQUEsQ0FBQWdELENBRkEsSUFHQSxLQUFBdEUsS0FBQSxDQUFBbUUsWUFBQSxFQUFBLEdBSEEsRUFLQUMsT0FBQSxDQUFBQyxHQUFBLENBQUEsS0FBQXJFLEtBQUEsQ0FBQW1FLFlBQUEsQ0FDQSxDLFNBR0F0RSxNQUFBLENBQUEsR0FBQUYsQ0FBQUEsTUFBQSxDQUFBLFdBQUEsQyxDQUVBNEUsYUFBQSxDQUFBekUsUUFBQSxDQUFBQyxhQUFBLENBQUEscUJBQUEsQyxDQUNBeUUsU0FBQSxDQUFBMUUsUUFBQSxDQUFBQyxhQUFBLENBQUEsbUJBQUEsQyxDQUNBbUUsTUFBQSxDQUFBNUQsZ0JBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQW1FLENBQUEsQ0FBQSxFQUNBQSxDQUFBLENBQUFuRCxNQUFBLEVBQUFpRCxhQUFBLEVBQUFFLENBQUEsQ0FBQW5ELE1BQUEsR0FBQWtELFNBQUEsRUFBQUQsYUFBQSxHQUFBRSxDQUFBLENBQUFuRCxNQUFBLEVBQUFrRCxTQUFBLENBQUF0QyxTQUFBLENBQUF3QyxRQUFBLENBQUEsMEJBQUEsQ0FEQSxHQUVBRixTQUFBLENBQUF0QyxTQUFBLENBQUFDLE1BQUEsQ0FBQSwwQkFBQSxDQUVBLENBSkEsQyIsImZpbGUiOiJwbGF5ZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVk9MVU1FX0lDT05TID0ge1xyXG4gICAgdXA6ICdmYS12b2x1bWUtdXAnLFxyXG4gICAgZG93bjogJ2ZhLXZvbHVtZS1kb3duJyxcclxuICAgIG9mZjogJ2ZhLXZvbHVtZS1vZmYnLFxyXG4gICAgbXV0ZTogJ2ZhLXZvbHVtZS1tdXRlJ1xyXG59XHJcbmNvbnN0IEZVTExTQ1JFRU5fSUNPTlMgPSB7XHJcbiAgICBjb21wcmVzczogJ2ZhLWNvbXByZXNzJyxcclxuICAgIGV4cGFuZDogJ2ZhLWV4cGFuZCdcclxufVxyXG5jbGFzcyBQbGF5ZXIge1xyXG4gICAgY29uc3RydWN0b3Ioc2VsZWN0b3Ipe1xyXG4gICAgICAgIHRoaXMucGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzZWxlY3RvcilcclxuICAgICAgICB0aGlzLnZpZGVvID0gdGhpcy5wbGF5ZXI/LnF1ZXJ5U2VsZWN0b3IoJ3ZpZGVvJylcclxuICAgICAgICBpZiAoIXRoaXMucGxheWVyIHx8ICF0aGlzLnZpZGVvKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUGxheWVyIG9yIHZpZGVvIG5vdCBmb3VuZCcpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5pdFZpZGVvTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgdGhpcy5pbml0UGxheWVyTGlzdGVuZXJzKCk7XHJcbiAgICAgICAgdGhpcy5pbml0VGltZWxpbmVMaXN0ZW5lcnMoKTtcclxuICAgICAgICB0aGlzLmluaXRQYWdlTGlzdGVuZXJzKCk7XHJcbiAgICB9XHJcbiAgICBpbml0VmlkZW9MaXN0ZW5lcnMoKXtcclxuICAgICAgICB0aGlzLnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy50b2dnbGVWaWRlby5iaW5kKHRoaXMpKTtcclxuICAgICAgICB0aGlzLnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZG1ldGFkYXRhJywgKCkgPT4ge1xyXG4gICAgICAgICB0aGlzLnNldFZpZGVvRHVyYXRpb24oKVxyXG4gICAgICAgICB0aGlzLnVwZGF0ZVZvbHVtZUlucHV0KClcclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5zZXRWaWRlb0R1cmF0aW9uKClcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVJbnRlcmZhY2UoKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy52aWRlby5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsIHRoaXMudG9nZ2xlRnVsbHNjcmVlbi5iaW5kKHRoaXMpKVxyXG4gICAgICAgIHRoaXMudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigndm9sdW1lY2hhbmdlJywgdGhpcy51cGRhdGVWb2x1bWVJbnB1dC5iaW5kKHRoaXMpKVxyXG4gICAgfVxyXG4gICAgaW5pdFBsYXllckxpc3RlbmVycygpe1xyXG4gICAgICAgIHRoaXMucGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCB0aGlzLmNoZWNrRnVsbHNjcmVlbi5iaW5kKHRoaXMpKVxyXG4gICAgICAgIHRoaXMucGxheWVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuY2hlY2tJbnRlcmZhY2UuYmluZCh0aGlzKSlcclxuICAgICAgICB0aGlzLnBsYXllci5xdWVyeVNlbGVjdG9yKCcuai10b2dnbGUtdmlkZW8nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMudG9nZ2xlVmlkZW8uYmluZCh0aGlzKSlcclxuICAgICAgICB0aGlzLnBsYXllci5xdWVyeVNlbGVjdG9yKCcuai12b2x1bWUtaW5wdXQnKS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHRoaXMuc2V0Vm9sdW1lLmJpbmQodGhpcykpXHJcbiAgICAgICAgdGhpcy5wbGF5ZXIucXVlcnlTZWxlY3RvcignLmotdG9nZ2xlLXZvbHVtZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT57XHJcbiAgICAgICAgICAgIHRoaXMudmlkZW8udm9sdW1lID0gTnVtYmVyKHRoaXMudmlkZW8udm9sdW1lICE9PSAxKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIHRoaXMucGxheWVyLnF1ZXJ5U2VsZWN0b3IoJy5qLWZ1bGxzY3JlZW4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMudG9nZ2xlRnVsbHNjcmVlbi5iaW5kKHRoaXMpKVxyXG4gICAgICAgIHRoaXMucGxheWVyLnF1ZXJ5U2VsZWN0b3IoJy5zcGVlZF9fY2hhbmdlLWJ1dHRvbi0tc3BlZWQtZG93bicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jaGFuZ2VTcGVlZERvd24uYmluZCh0aGlzKSlcclxuICAgICAgICB0aGlzLnBsYXllci5xdWVyeVNlbGVjdG9yKCcuc3BlZWRfX2NoYW5nZS1idXR0b24tLXNwZWVkLXVwJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNoYW5nZVNwZWVkVXAuYmluZCh0aGlzKSlcclxuICAgIH1cclxuICAgIGluaXRUaW1lbGluZUxpc3RlbmVycygpe1xyXG4gICAgICAgIGNvbnN0IGxpbmUgPSB0aGlzLnBsYXllci5xdWVyeVNlbGVjdG9yKCcuai1saW5lJyk7XHJcbiAgICAgICAgbGluZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLmNhbGNHaG9zdExpbmUuYmluZCh0aGlzKSlcclxuICAgICAgICBsaW5lLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PntcclxuICAgICAgICAgICAgY29uc3QgeyBsZWZ0IH0gPSBldmVudC50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuICAgICAgICAgICAgdGhpcy52aWRlby5jdXJyZW50VGltZSA9IHRoaXMuY2FsY05lZWRlZExpbmUoZXZlbnQsIGxlZnQpXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuICAgIGluaXRQYWdlTGlzdGVuZXJzKCl7XHJcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXZlbnQuY29kZSA9PT0gJ1NwYWNlJykge1xyXG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVmlkZW8oKVxyXG4gICAgICAgICAgICB9ZWxzZSBpZiAoZXZlbnQuY29kZSA9PT0gJ0Fycm93UmlnaHQnKXtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlkZW8uY3VycmVudFRpbWUgKz0gNVxyXG4gICAgICAgICAgICB9ZWxzZSBpZiAoZXZlbnQuY29kZSA9PT0gJ0Fycm93TGVmdCcpe1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWRlby5jdXJyZW50VGltZSAtPSA1XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgc2V0Vm9sdW1lKCB7IHRhcmdldCB9ICkge1xyXG4gICAgICAgIHRoaXMudmlkZW8udm9sdW1lID0gdGFyZ2V0LnZhbHVlIC8gMTAwO1xyXG4gICAgfVxyXG4gICAgdG9nZ2xlVmlkZW8oKXtcclxuICAgICAgICB0aGlzLmlzUGxheWluZyA9ICF0aGlzLmlzUGxheWluZztcclxuICAgICAgICBjb25zdCBpY29uID0gdGhpcy5wbGF5ZXIucXVlcnlTZWxlY3RvcignLmotdG9nZ2xlLXZpZGVvIC5mYXMnKTtcclxuICAgICAgICB0aGlzLnBsYXllci5xdWVyeVNlbGVjdG9yKCcuai1wbGF5Jykuc3R5bGUuZGlzcGxheSA9IHRoaXMuaXNQbGF5aW5nID8gJ2Jsb2NrJyA6ICdub25lJ1xyXG4gICAgICAgIHRoaXMucGxheWVyLnF1ZXJ5U2VsZWN0b3IoJy5qLXBhdXNlJykuc3R5bGUuZGlzcGxheSA9ICF0aGlzLmlzUGxheWluZyA/ICdibG9jaycgOiAnbm9uZSdcclxuICAgICAgICBpY29uLmNsYXNzTGlzdC50b2dnbGUoJ2ZhLXBsYXknLCAhdGhpcy5pc1BsYXlpbmcpXHJcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QudG9nZ2xlKCdmYS1wYXVzZScsIHRoaXMuaXNQbGF5aW5nKVxyXG4gICAgICAgIHRoaXMudmlkZW9bdGhpcy5pc1BsYXlpbmcgPyAncGxheScgOiAncGF1c2UnXSgpXHJcbiAgICB9XHJcbiAgICBmaXhOdW1iZXIobnVtYmVyKXtcclxuICAgICAgICByZXR1cm4gbnVtYmVyIDwgMTAgPyBgMCR7bnVtYmVyfWAgOiBgJHtudW1iZXJ9YFxyXG4gICAgfVxyXG4gICAgZm9ybWF0VGltZShzZWNvbmRzKXtcclxuICAgICAgICByZXR1cm4gYCR7TWF0aC5mbG9vcihzZWNvbmRzIC8gNjApfToke3RoaXMuZml4TnVtYmVyKE1hdGguZmxvb3Ioc2Vjb25kcyAlIDYwKSl9YDtcclxuICAgIH1cclxuICAgIHNldFZpZGVvRHVyYXRpb24oKSB7XHJcbiAgICAgICAgY29uc3QgZHVyYXRpb24gPSBOdW1iZXIodGhpcy52aWRlby5kdXJhdGlvbi50b0ZpeGVkKCkpXHJcbiAgICAgICAgY29uc3QgY3VycmVudCA9IE51bWJlcih0aGlzLnZpZGVvLmN1cnJlbnRUaW1lLnRvRml4ZWQoKSlcclxuICAgICAgICBjb25zdCBuZXdUaW1lID0gYCR7dGhpcy5mb3JtYXRUaW1lKGN1cnJlbnQpfSAvICR7dGhpcy5mb3JtYXRUaW1lKGR1cmF0aW9uKX1gXHJcbiAgICAgICAgY29uc3QgZHVyYXRpb25FbGVtZW50ID0gdGhpcy5wbGF5ZXIucXVlcnlTZWxlY3RvcignLmotZHVyYXRpb24nKVxyXG4gICAgICAgIHRoaXMucGxheWVyLnF1ZXJ5U2VsZWN0b3IoJy5qLWxpbmUtY3VycmVudCcpLnN0eWxlLndpZHRoID0gYCR7Y3VycmVudCAvIChkdXJhdGlvbiAvIDEwMCl9JWBcclxuICAgICAgICBpZiAoZHVyYXRpb25FbGVtZW50LmlubmVySFRNTCAhPT0gbmV3VGltZSkge1xyXG4gICAgICAgICAgICAgZHVyYXRpb25FbGVtZW50LmlubmVySFRNTCA9IG5ld1RpbWVcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0b2dnbGVGdWxsc2NyZWVuKCl7XHJcbiAgICAgICAgaWYgKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKClcclxuICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXIucmVxdWVzdEZ1bGxzY3JlZW4oKVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBsYXllci5yZXF1ZXN0RnVsbHNjcmVlbigpXHJcbiAgICB9XHJcbiAgICBjaGVja0Z1bGxzY3JlZW4oKXtcclxuICAgICAgICBjb25zdCBpc0Z1bGxzY3JlZW4gPSBCb29sZWFuKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KTtcclxuICAgICAgICBjb25zdCBpY29uID0gdGhpcy5wbGF5ZXIucXVlcnlTZWxlY3RvcignLmotZnVsbHNjcmVlbiAuZmFzJylcclxuICAgICAgICBcclxuICAgICAgICBpY29uLmNsYXNzTGlzdC50b2dnbGUoRlVMTFNDUkVFTl9JQ09OUy5jb21wcmVzcywgIWlzRnVsbHNjcmVlbilcclxuICAgICAgICBpY29uLmNsYXNzTGlzdC50b2dnbGUoRlVMTFNDUkVFTl9JQ09OUy5leHBhbmQsIGlzRnVsbHNjcmVlbilcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLnBsYXllci5jbGFzc0xpc3QudG9nZ2xlKCdwbGF5ZXItLWZ1bGxzY3JlZW4nLCBpc0Z1bGxzY3JlZW4pXHJcbiAgICB9XHJcbiAgICBjYWxjTmVlZGVkTGluZShldmVudCwgbGVmdCl7XHJcbiAgICAgICAgY29uc3QgbmVlZFBlcmNlbnQgPSAoKGV2ZW50LmNsaWVudFggLSBsZWZ0KSAvIGV2ZW50LnRhcmdldC5vZmZzZXRXaWR0aClcclxuICAgICAgICByZXR1cm4gdGhpcy52aWRlby5kdXJhdGlvbiAqIG5lZWRQZXJjZW50O1xyXG4gICAgfVxyXG4gICAgdXBkYXRlVm9sdW1lSW5wdXQoKXtcclxuICAgICAgICBjb25zdCB0b2dnbGVDbGFzc2VzID0gdGhpcy5wbGF5ZXIucXVlcnlTZWxlY3RvcignLmotdG9nZ2xlLXZvbHVtZScpLmNsYXNzTGlzdFxyXG4gICAgICAgIHRoaXMucGxheWVyLnF1ZXJ5U2VsZWN0b3IoJy5qLXZvbHVtZS1pbnB1dCcpLnZhbHVlID0gdGhpcy52aWRlby52b2x1bWUgKiAxMDBcclxuICAgICAgICB0b2dnbGVDbGFzc2VzLnJlbW92ZShWT0xVTUVfSUNPTlMudXAsIFZPTFVNRV9JQ09OUy5kb3duLCBWT0xVTUVfSUNPTlMub2ZmLCBWT0xVTUVfSUNPTlMubXV0ZSlcclxuICAgICAgICBpZiAodGhpcy52aWRlby52b2x1bWUgPiAwLjY2KSB7XHJcbiAgICAgICAgICAgIHRvZ2dsZUNsYXNzZXMuYWRkKFZPTFVNRV9JQ09OUy51cClcclxuICAgICAgICB9ZWxzZSBpZih0aGlzLnZpZGVvLnZvbHVtZSA+IDAuMzMpe1xyXG4gICAgICAgICAgICB0b2dnbGVDbGFzc2VzLmFkZChWT0xVTUVfSUNPTlMuZG93bilcclxuICAgICAgICB9ZWxzZSBpZih0aGlzLnZpZGVvLnZvbHVtZSA+IDApe1xyXG4gICAgICAgICAgICB0b2dnbGVDbGFzc2VzLmFkZChWT0xVTUVfSUNPTlMub2ZmKVxyXG4gICAgICAgIH1lbHNlIGlmKHRoaXMudmlkZW8udm9sdW1lID09PSAwKXtcclxuICAgICAgICAgICAgdG9nZ2xlQ2xhc3Nlcy5hZGQoVk9MVU1FX0lDT05TLm11dGUpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY2FsY0dob3N0TGluZShldmVudCl7XHJcbiAgICAgICAgY29uc3QgeyBsZWZ0IH0gPSBldmVudC50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KClcclxuICAgICAgICBjb25zdCBoaW50ID0gdGhpcy5wbGF5ZXIucXVlcnlTZWxlY3RvcignLmotaGludCcpXHJcbiAgICAgICAgY29uc3QgZ2hvc3QgPSB0aGlzLnBsYXllci5xdWVyeVNlbGVjdG9yKCcuai1saW5lLWdob3N0JylcclxuICAgICAgICBoaW50LmlubmVySFRNTCA9IHRoaXMuZm9ybWF0VGltZSh0aGlzLmNhbGNOZWVkZWRMaW5lKGV2ZW50LCBsZWZ0KSlcclxuICAgICAgICBoaW50LnN0eWxlLmxlZnQgPSBgJHtldmVudC5jbGllbnRYIC0gKGxlZnQgKyAoaGludC5vZmZzZXRXaWR0aCAvIDIpKX1weGBcclxuICAgICAgICBnaG9zdC5zdHlsZS53aWR0aCA9IGAke2V2ZW50LmNsaWVudFggLSBsZWZ0fXB4YFxyXG4gICAgfVxyXG4gICAgdG9nZ2xlSW50ZXJmYWNlKCl7XHJcbiAgICAgICAgdGhpcy5wbGF5ZXIuY2xhc3NMaXN0LnRvZ2dsZSgncGxheWVyLS1oaWRlLWludGVyZmFjZScsIHRoaXMuaXNIaWRkZW5JbnRlcmZhY2UpXHJcbiAgICB9XHJcbiAgICBjaGVja0ludGVyZmFjZSgpe1xyXG4gICAgICAgIHRoaXMuaXNIaWRkZW5JbnRlcmZhY2UgPSBmYWxzZVxyXG4gICAgICAgIGlmICh0aGlzLnRpbWVvdXQpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dClcclxuICAgICAgICAgICAgdGhpcy50aW1lb3V0ID0gbnVsbFxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5pc0hpZGRlbkludGVyZmFjZSA9IHRydWVcclxuICAgICAgICB9LCA1MDAwKTtcclxuICAgIH1cclxuY2hhbmdlU3BlZWREb3duKCl7XHJcbiAgICBsZXQgc3BlZWREb3duID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNwZWVkX19jaGFuZ2UtYnV0dG9uLS1zcGVlZC1kb3duJylcclxuICAgIGlmICh3aW5kb3cudGFyZ2V0ID0gc3BlZWREb3duKSB7XHJcbiAgICAgICAgdGhpcy52aWRlby5wbGF5YmFja1JhdGUgLT0gMC4yNVxyXG4gICAgfVxyXG4gICAgaWYodGhpcy52aWRlby5wbGF5YmFja1JhdGUgPD0gMC4yNSl7XHJcbiAgICAgICAgdGhpcy52aWRlby5wbGF5YmFja1JhdGUgPSAwLjI1XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyh0aGlzLnZpZGVvLnBsYXliYWNrUmF0ZSk7XHJcbn1cclxuY2hhbmdlU3BlZWRVcCgpe1xyXG4gICAgbGV0IHNwZWVkVXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3BlZWRfX2NoYW5nZS1idXR0b24tLXNwZWVkLXVwJylcclxuICAgIGlmICh3aW5kb3cudGFyZ2V0ID0gc3BlZWRVcCkge1xyXG4gICAgICAgIHRoaXMudmlkZW8ucGxheWJhY2tSYXRlICs9IDAuMjVcclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKHRoaXMudmlkZW8ucGxheWJhY2tSYXRlKTtcclxufVxyXG59XHJcblxyXG5jb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKCcuai1wbGF5ZXInKVxyXG4iXX0=
